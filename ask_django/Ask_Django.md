# Ask Django

* 아임포트
* 쇼핑몰

### 이니시스(PG)

```
User -> Service -> PG -> Service -> User
```

많은 PG사들은 ASP/PHP/JSP 샘플만 제공

* 결제부분만 `php-cli`를 통해 PHP로 처리하기도 함
* UTF-8이 아닌 euc-kr 인코딩을 쓰기도 함

### 아임포트

* 각 PG사들에 대한 Gateway
* 단일 API로 국내 많은 PG사들을 커버
	* 개발환경에 중립적
	
```
Service -> Import -> Pg -> Import -> Service
```

> 카카오페이, 이니시스(웹표준결제), 나이스페이..

* JavaScript 코드 하나로 PC/Mobile/In-App 결제 모두 지원

* 기본기능에 대해서 FREE
	* 1개 PG사 연동
	* 기본 관리자 대시보드
	* 기본 기능 사용 제약 없음
* 유료부분
	* 2개 이상 PG사 연동(최초 1회만 10만원)
	* 결제 데이터 분석(월 39,000원)

### Process

1. 구매자는 카드사 웹페이지를 통해 카드번호/유효시간/비밀번호를 입력하여 카드를 확인
	* 이때, 카드정보의 보호를 위해 별도의 프로그램 설치를 요구
2. 카드정보가 확인되면, 카드사는 `1회성 인증키`를 PG사에 제공하며, 이 인증키가 실제 결제에 사용됨
3. 가맹점 서버: 인증단계에서 사용된 주문번호, 구매자 연락처 등의 정보를 PG사 서버로 전송
4. PG사는 카드사로부터 전달된 인증키와 함께 해당 카드사로 승인요청을 진행
	* <b> 실제 카드사로부터 결제승인에 대한 결과를 알 수 있다.</b> 결제승인 혹은 결제실패(한도초과/분실카드 등의 사유)가 판단됨

### 안심클릭/ISP 결제모듈

* PC에서는 계열에 상관없이 동일한 인터페이스
* 모바일에서는 연동방식의 차이가 있음

`안심클릭`: 카드번호, CVC, 안심클릭 비밀번호를 입력하여 카드정보를 인증
- 별도의 앱이 필요없음, 모바일 브라우저나 WEbView 앱결제가 동일한 처리

`ISP`: 공개키 기반의 전자인증서를 통해 사전에 등록된 카드정보를 인증

- ISP앱 설치.인증서복사를 요구
- ISP를 거쳤다가, 다시 래 결제프로세스로 이동
- 다시 앱으로 돌아오기 위해, `URL Scheme` 정의/처리가 필요
	* http://로 요청을 할경우 웹요청인것을 앎
	* baemin://으로 시작하는 URL Scheme를 쓰겠다고 설정(앱의 경우)

### 비인증결제

* Key-in 결제: 전화를 통한 비대면 상황에서 카드정보 + 개인정보를 활용해 결제
* 빌링 결제: 정기 결제

개발자는 아임포트가 제공하는 표준화된 API로 간편히 연동

1. PG창 결제창 호출 -> 결제 결과 수신`IMPORT-UID`
2. 결제 조회/검증(REST API)







